<!DOCTYPE html> <<!--declares the file as html-->
<html lang="en"><<!--sets the language to English-->
<head>
  <meta charset="UTF-8"><<!--sets character encoding so you can see emojis and other special characters-->
  <title>WebChat</title><!-- sets the title that will show up in the browser tab -->

  <!-- load socket.IO and jQuery libraries -->
  <script src="https://cdn.socket.io/4.0.0/socket.io.min.js"></script>
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

  <!-- CSS -->
  <style>
    /* --- page setup --- */
    body {
      display: flex; /* makes layout flexible to different browsers/devices */
      flex-direction: column;/* stacks items vertically */
      height: 100vh;/* full screen */
      margin: 0; /* remove margins */
      font-family: 'Segoe UI', Arial, sans-serif; /* sets font */
      background-color: #f4f6f8; /* sets bg color as white */
    }

    /* --- header  --- */
    header {
      background-color: #007bff; /* sets the color to a blue header */
      color: white; /* makes the text white */
      padding: 14px 20px; /* adds space around the text */
      font-size: 20px; /* sets the font larger */
      font-weight: bold; /* makes the font bold */
      display: flex; /* makes layout flexible to diff screens */
      justify-content: space-between; /* spaces out title and username */
      align-items: center;  /* vertically centers items on page */
      box-shadow: 0 2px 5px rgba(0,0,0,0.2); /* adds shadow below header to make it look nice */
    }

    /* --- username display --- */
    #user-display {
      font-size: 16px; /* slightly smaller font for username */
      font-weight: normal; /* normal font weight for username */
      opacity: 0.9; /* slightly faded look */
    }

    /* --- messages --- */
    #messages {
      flex: 1; /* takes up all available space */
      overflow-y: auto; /* adds vertical scrollbar for when messages increase */
      padding: 20px; /* adds space  around messages*/
      list-style-type: none; /* removes default bullet points */
      margin: 0; /* removes default margin */
      display: flex; /* makes layout flexible for diff screens */
      flex-direction: column; /* stacks messages vertically */
    }

    /* --- message bubbles --- */
    #messages li {
      margin-bottom: 12px; /* space between messages */
      padding: 10px 15px; /* space inside message bubble */
      border-radius: 16px; /* rounded corners for message bubble */
      max-width: 70%; /* limits width of message bubble */
      word-wrap: break-word; /* makes sure that long words break to next line */
      box-shadow: 0 2px 4px rgba(0,0,0,0.1); /* adds shadow to message bubble */
      animation: fadeIn 0.3s ease; /* applies fade-in animation when messages come in*/
    }

    /* --- recieving messages --- */
    #messages li.other {
      background-color: #ffffff; /* light gray background for other users' messages */
      align-self: flex-start; /* aligns other ppls messages to the left side */
    }

    /* --- sending messages --- */
    #messages li.me {
      background-color: #007bff; /* blue background for your messages */
      color: white; /* white text for your messages */
      align-self: flex-end; /* aligns your messages to the right side */
    }

    /* --- username label above messages sent by u --- */
    #messages strong {
      display: block; /* makes username appear on its own line */
      margin-bottom: 4px; /* space between username and message */
      font-size: 0.9em; /* slightly smaller font for username */
      opacity: 0.8; /* slightly faded look for username */
    }

    /* --- input area --- */
    form {
      display: flex; /* makes layout flexible for diff screens */
      padding: 12px; /* adds space around input area */
      border-top: 1px solid #ccc; /* adds a light border on top */
      background-color: white; /* white background for input area */
    }

    /* --- text input--- */
    input[type="text"] { 
      flex: 1; /* takes up all available space */
      padding: 12px; /* adds space inside input box */
      border: 1px solid #ccc; /* light gray border */
      border-radius: 8px; /* rounded corners for input box */
      margin-right: 10px; /* space between input box and send button */
      font-size: 16px; /* sets font size */
    }

    /* --- send button --- */
    button {
      padding: 12px 18px; /* adds space inside button */
      border: none; /* removes default border */
      border-radius: 8px; /* rounded corners for button */
      background-color: #007bff; /* blue background for button */
      color: white; /* white text for button */
      font-size: 16px; /* sets font size */
      cursor: pointer; /* changes cursor to pointer on hover */
      transition: background-color 0.2s; /* smooth transition for hover effect */
    }

    button:hover { 
      background-color: #0056b3; /* darker blue on hover */
    }

    /* --- scrollbar --- */
    #messages::-webkit-scrollbar {
      width: 8px; /* width of scrollbar */
    }
    #messages::-webkit-scrollbar-thumb {
      background-color: #ccc; /* color of scrollbar thumb */
      border-radius: 10px; /* rounded corners for scrollbar thumb */
    }

    /* --- message send in animation --- */
    @keyframes fadeIn { /* used to make animations */
      from { opacity: 0; transform: translateY(10px); /* start slightly below and transparent */ }  
      to { opacity: 1; transform: translateY(0); } /* end at normal position and fully visible */
    }
  </style>

  <!--    main chat script  -->
  <script> /* runs when page is fully loaded */
    $(document).ready(function() { 
      // connect to the socket.io server
      var socket = io();

      // store the current user's username
      var username;

      // load a notification sound (small .mp3 hosted online i imported)
      var messageSound = new Audio("https://actions.google.com/sounds/v1/cartoon/wood_plank_flicks.ogg");

      // when connected to the server
      socket.on('connect', function() {
        username = prompt("Enter your username:");
        if (!username || username.trim() === "") {
          username = "Anonymous";
        }

        // show username in the header
        $('#user-display').text("Logged in as: " + username);

        // also store in hidden input
        $('#username').val(username);

        // notify server that this user joined
        socket.emit('join', { username: username });
      });

      // handle message submission
      $('form').submit(function(event) {
        event.preventDefault(); // stop page reload

        var message = $('#message').val().trim();
        if (message === "") return; // ignore empty messages

        // send message to server
        socket.emit('message', { user: username, msg: message });

        // clear input field
        $('#message').val('');
      });

      // when receiving a message from server
      socket.on('message', function(data) {
        // escape text to avoid XSS
        var safeUser = $('<div>').text(data.user).html();
        var safeMsg = $('<div>').text(data.msg).html();

        // decide message class
        var msgClass = data.user === username ? 'me' : 'other';

        // build message element
        var $msgItem = $('<li>').addClass(msgClass);
        $msgItem.html('<strong>' + safeUser + '</strong>' + safeMsg);

        // add to list
        $('#messages').append($msgItem);

        // play notification sound (for all messages)
        messageSound.currentTime = 0; // restart if still playing
        messageSound.play().catch(() => {}); // ignore autoplay restrictions

        // auto-scroll to bottom
        $('#messages').scrollTop($('#messages')[0].scrollHeight);
      });

      // handle server error event
      socket.on('error', function(data) {
        alert(data.message);
      });
    });
  </script>
</head>

<body>
  <!--    header bar -->
  <header>
    <div> WebChat</div>
    <div id="user-display">Not logged in</div>
  </header>

  <!--    message list -->
  <ul id="messages"></ul>

  <!--   input -->
  <form action="">
    <input id="username" type="hidden">
    <input id="message" type="text" autocomplete="off" placeholder="Type your message here...">
    <button>Send</button>
  </form>
</body>
</html>
